<%# Todo: Get the actual value of the host id here %>
<% host_id = 1 %>
///////////////////////////////////////////////////////////////////////////////////////////////////
// Common functions
///////////////////////////////////////////////////////////////////////////////////////////////////
// Generating a random string for the user
function makeid()
{
  var text = "";
  var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

  for( var i=0; i < 5; i++ )
    text += possible.charAt(Math.floor(Math.random() * possible.length));

  return text;
}
///////////////////////////////////////////////////////////////////////////////////////////////////
// Live chat
///////////////////////////////////////////////////////////////////////////////////////////////////
// common variables
var currentUserAnonymousId = makeid();
var baseCurrentHostUrl = 'https://urbanzeak.firebaseio.com/hosts/' + <%= host_id %> + '/';
var presenceUrl = baseCurrentHostUrl + 'usersViewing/';
var currentUserUrl = baseCurrentHostUrl + 'customers/' + currentUserAnonymousId + '/';
var currentUserMessagesUrl = currentUserUrl + 'messages/';

// Data structure urls
var newUserPresenceRef = new Firebase(presenceUrl);
var currentUserMessagesRef = new Firebase(currentUserMessagesUrl);

newUserPresenceRef.push({id: currentUserAnonymousId});

$('#message').keypress(function(e){
  if (e.keyCode == 13){
    //var name = 'John' //$('#chatName').val();
    var message = $('#message').val();
    currentUserMessagesRef.push({message: message});
  }
});

currentUserMessagesRef.on('child_added', function(snapshot) {
  var message = snapshot.val();
  displayChatMessage(message.message);
  $('#message').val('');
});
function displayChatMessage(text) {
  $('<div/>').text(text).prepend($('<em/>').text(name+' ')).appendTo($('#chatText'));
  $('#chatText')[0].scrollTop = $('#chatText')[0].scrollHeight;
};


/*
hostChatRef.limit(10).on('child_added', function(snapshot){
  var message = snapshot.val();
  $('')
});
*/
///////////////////////////////////////////////////////////////////////////////////////////////////
// General
///////////////////////////////////////////////////////////////////////////////////////////////////
$(document).ready(function(){
    //$('#newExperienceModal').modal('show');
    /*
    $("#map").gmap3({
        map:{
            options:{
                center:[22.49156846196823, 89.75802349999992],
                zoom:10,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                mapTypeControl: true,
                mapTypeControlOptions: {
                    style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
                },
                navigationControl: true,
                scrollwheel: true,
                streetViewControl: true
            },
            events:{
                click: function(event, data){
                    // Getting the latitude and longitude for the location clicked on the map
                    console.log("The event is:", data.latLng);
                    //var latitude = $("#map").gmap3(marker.value);
                    $('#experience_latitude').val(data.latLng.lat());
                    $('#experience_longitude').val(data.latLng.lng());
                    $(this).gmap3({
                        clear: "marker",
                        marker: {
                            latLng: data.latLng
                        }
                    });
                }
            }

        }
    });
    */
  // Chat modal
  $(".fancybox").fancybox({
    'autoSize': false,
    'padding': [0,0,0,0],
    'width': 800,
    'height': 400
  });



});


