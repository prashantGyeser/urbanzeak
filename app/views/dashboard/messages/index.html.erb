<%= content_for :js do %>
  <%= javascript_include_tag "dashboard/messages.js", 'data-turbolinks-track' => true %>
<% end %>


<div class="page-title">
  <h3>Support</h3>
</div>

<!--ROW START-->
<div class="row">
  <!--12 COL START-->
  <div class="col-md-12">

    <% @messages_groups.each do |from, messages| %>
      <% first_message = Message.where(:from => from).where('name IS NOT NULL').first %>
      <% if first_message.nil? %>
        <% name = from %>
      <% else %>
        <% name = sender_name %>
      <% end %>

      <% if from == current_user.internal_email_id %>
      <% else %>
        <div class="grid simple no-border">
          <!--GRID TITLE START-->
          <div class="grid-title no-border descriptive clickable">
            <h4 class="semi-bold">Message from <%= name %></h4>
            <p>
              <span class="text-success bold">Ticket #456</span>
              - Created on 10/29/13 at 06:33 - Last reply About 1 Month ago by alex&nbsp;&nbsp;
              <!--<span class="label label-info">NEW MESSAGE</span>-->
            </p>
            <div class="actions">
              <a class="view" href="javascript:;"><i class="fa fa-search"></i></a>
              <a class="remove" href="javascript:;"><i class="fa fa-times"></i></a>
            </div>
          </div>
          <!--GRID TITLE END-->
          <!--GRID BODY START -- HIDDEN TO BEGIN WITH OPENS ON USER CLICK-->
          <div class="grid-body no-border" style="display: none">
            <% messages.each do |message|%>
              <!--INDIVIDUAL POST START-->
              <div class="post p-b-20">
                <h4><span class="semi-bold"><%= message.from %></span> said:</h4>
                <div class="info-wrapper">
                  <div class="info">
                    <%= message.body %>
                  </div>
                  <div class="clearfix"></div>
                </div>
                <div class="clearfix"></div>
              </div>
              <!--INDIVIDUAL POST END-->
              <br/>
            <% end %>
            <!--SUBMIT REPLY FORM START-->
            <div class="form-actions">
              <div class="post col-md-12">

                <div class="info-wrapper">
                  <div class="form-group">
                    <label class="form-label"><i class="fa fa-reply"></i>&nbsp;Post a reply</label>
                    <div class="controls">
                      <input type="text" class="form-control">
                      <input type="hidden" class="hidden_email" value="<%= from %>"/>
                    </div>
                  </div>
                  <div class="clearfix"></div>
                </div>
                <div class="clearfix"></div>
              </div>
            </div>
            <!--SUBMIT REPLY FORM END-->
          </div>
          <!--GRID BODY END -- HIDDEN TO BEGIN WITH OPENS ON USER CLICK-->
        </div>
      <% end %>





    <% end %>


    <!--CLOSED TICKETS START-->
    <h4>Closed <span class="semi-bold">Tickets</span></h4>
    <br/>
    <!--CLOSED TICKETS ROW START-->
    <div class="row">
      <div class="col-md-12">
        <div class="grid simple no-border">
          <div class="grid-title no-border descriptive clickable">
            <h4 class="semi-bold">Too many down times</h4>
            <p ><span class="text-success bold">Ticket #456</span> - Created on 10/29/13 at 06:33 - Last reply About 1 Month ago by alex&nbsp;&nbsp;<span class="label label-important">ALERT</span></p>
            <div class="actions"> <a class="expand" href="javascript:;"><i class="fa fa-search"></i></a> <a class="view" href="javascript:;"><i class="fa fa-times"></i></a> </div>
          </div>
          <div class="grid-body  no-border" style="display:none">
            <div class="post">
              <div class="user-profile-pic-wrapper">
                <div class="user-profile-pic-normal"> <img width="35" height="35" data-src-retina="assets/img/profiles/c2x.jpg" data-src="assets/img/profiles/c.jpg" src="assets/img/profiles/c.jpg" alt=""> </div>
              </div>
              <div class="info-wrapper">
                <div class="info"> Hi I have installed agent to monitor the usage of the droplet done via Anturis <br>
                  and lately there was a lot of down time. One that caught my eye was this <br>
                  Incident report<br>
                  <br>
                  New Critical Incident started at 13:10 MST on Monday, October 28 <br>
                  Critical Incident started at 13:10 MST on Monday, October 28 with ace has ended at 13:51 MST on Monday, October 28.<br>
                  <br>
                  Incident duration was 41 minutes.<br>
                  <br>
                  The server did not respond for 41 minutes.As you see 41 minutes is a big deal for us as we are going to lose alot of revenue we need you guys to check if these records are correct and if so why and will this happen again? or do we need to purchase some sort of cluster ? this is a very critical situation <br>
                  <br>
                  Waiting for your reply </div>
                <div class="clearfix"></div>
              </div>
              <div class="clearfix"></div>
            </div>
            <br>
            <div class="form-actions">
              <div class="post col-md-12">
                <div class="user-profile-pic-wrapper">
                  <div class="user-profile-pic-normal"> <img width="35" height="35" data-src-retina="assets/img/profiles/c2x.jpg" data-src="assets/img/profiles/c.jpg" src="assets/img/profiles/c.jpg" alt=""> </div>
                </div>
                <div class="info-wrapper">
                  <div class="info"> Hi,<br>
                    <br>
                    Thank you for reaching us, We are looking into this issue and will update you.<br>
                    <br>
                    Alex<br>
                    <hr>
                    <p>Posted on 10/29/13 at 07:21</p>
                  </div>
                  <div class="form-group">
                    <label class="form-label"><i class="fa fa-reply"></i>&nbsp;Amount</label>
                    <div class="input-with-icon  right"> <i class=""></i>
                      <input type="text" class="form-control">
                    </div>
                  </div>
                  <div class="clearfix"></div>
                </div>
                <div class="clearfix"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--CLOSED TICKETS ROW END-->
    <!--CLOSED TICKETS END-->

  </div>
  <!--12 COL END-->
</div>
<!--ROW END-->












<div id="inbox-wrapper" class="row">
  <div class="row">
    <div class="col-md-12">
      <div class="grid simple">
        <div class="grid-body no-border email-body">
        <br>
          <div class="row-fluid">
            <div class="row-fluid dataTables_wrapper">
              <h2 class=" inline">Messages </h2>
            </div>

          <div id="email-list">
          <table id="emails" class="table table-striped table-fixed-layout table-hover">
          <thead>
          <tr>
            <th class="medium-cell"></th>
            <th></th>
            <th class="medium-cell"></th>
          </tr>
          </thead>
          <tbody>

          <% @messages_groups.each do |from, messages| %>
            <%# sender = Message.where(:from => from).where("message.name IS NOT NULL") %>
            <% first_message = Message.where(:from => from).where('name IS NOT NULL').first %>
            <% if first_message.nil? %>
              <% name = from %>
            <% else %>
              <% name = sender_name %>
            <% end %>

            <% if from == current_user.internal_email_id %>

            <% else %>
              <!--INDIVIDUAL MESSAGE START-->
              <tr data-message-id="<%= messages.first.id %>">
                <td class="clickable v-align-middle"> <%= name %> </td>
                <td class="clickable tablefull v-align-middle"><span class="muted"><%= Message.where(:from => from).first.body %></span></td>
                <td class="clickable"><span class="muted">Yesterday </span></td>

              </tr>
              <!--INDIVIDUAL MESSAGE END-->
            <% end %>



          <% end %>

          </tbody>
          </table>
          </div>
          </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>