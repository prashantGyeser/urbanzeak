"use strict";angular.module("urbanfunhunterApp",["ngCookies","ngResource","ngSanitize","ngRoute","services.i18nNotifications","services.httpRequestTracker","ui.bootstrap","textAngular","Directive.AddThis","google-maps","security"]),angular.module("urbanfunhunterApp").constant("I18N.MESSAGES",{"errors.route.changeError":"Route change error","crud.user.save.success":"A user with id '{{id}}' was saved successfully.","crud.user.remove.success":"A user with id '{{id}}' was removed successfully.","crud.user.remove.error":"Something went wrong when removing user with id '{{id}}'.","crud.user.save.error":"Something went wrong when saving a user...","crud.project.save.success":"A project with id '{{id}}' was saved successfully.","crud.project.remove.success":"A project with id '{{id}}' was removed successfully.","crud.project.save.error":"Something went wrong when saving a project...","login.reason.notAuthorized":"You do not have the necessary access permissions.  Do you want to login as someone else?","login.reason.notAuthenticated":"You must be logged in to access this part of the application.","login.error.invalidCredentials":"Login failed.  Please check your credentials and try again.","login.error.serverError":"There was a problem with authenticating: {{exception}}."}),angular.module("urbanfunhunterApp").config(["$routeProvider","$locationProvider",function(){}]),angular.module("urbanfunhunterApp").run(["security",function(a){a.requestCurrentUser()}]),angular.module("urbanfunhunterApp").controller("AppCtrl",["$scope","i18nNotifications","localizedMessages",function(a,b){a.notifications=b,a.removeNotification=function(a){b.remove(a)},a.$on("$routeChangeError",function(a,c,d,e){b.pushForCurrentRoute("errors.route.changeError","error",{},{rejection:e})})}]),angular.module("urbanfunhunterApp").controller("HeaderCtrl",["$scope","$location","$route","security","breadcrumbs","notifications","httpRequestTracker",function(a,b,c,d,e,f,g){a.location=b,a.breadcrumbs=e,a.isAuthenticated=d.isAuthenticated,a.isAdmin=d.isAdmin,a.home=function(){d.isAuthenticated()?b.path("/experiences"):b.path("/")},a.isNavbarActive=function(a){return a===e.getFirst().name},a.hasPendingRequests=function(){return g.hasPendingRequests()}}]),angular.module("urbanfunhunterApp").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html",controller:"HomeCtrl"}).when("/experiences",{templateUrl:"views/experiences.html",controller:"ExperiencesCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/host/manage",{templateUrl:"views/host/manage.html",controller:"HostManageCtrl"}).when("/myexperiences/manage",{templateUrl:"views/myexperiences/manage.html",controller:"MyexperiencesManageCtrl"}).when("/experiences/new",{templateUrl:"views/experiences/new.html",controller:"ExperiencesNewCtrl"}).when("/experiences/:experienceId",{templateUrl:"views/experiences/show.html",controller:"ExperiencesShowCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("urbanfunhunterApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("urbanfunhunterApp").controller("HomeCtrl",["$scope","$modal","Experience",function(a,b,c){c.experiences().then(function(b){a.experiences=b}),a.host=[{name:"Jane Doe",picture:"http://someurl"}]}]),angular.module("urbanfunhunterApp").factory("experience",function(){var a=42;return{someMethod:function(){return a}}}),angular.module("urbanfunhunterApp").controller("ExperiencesCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("security.authorization",["security.service"]).provider("securityAuthorization",{requireAdminUser:["securityAuthorization",function(a){return a.requireAdminUser()}],requireAuthenticatedUser:["securityAuthorization",function(a){return a.requireAuthenticatedUser()}],$get:["security","securityRetryQueue",function(a,b){var c={requireAuthenticatedUser:function(){var d=a.requestCurrentUser().then(function(){return a.isAuthenticated()?void 0:b.pushRetryFn("unauthenticated-client",c.requireAuthenticatedUser)});return d},requireAdminUser:function(){var d=a.requestCurrentUser().then(function(){return a.isAdmin()?void 0:b.pushRetryFn("unauthorized-client",c.requireAdminUser)});return d}};return c}]}),angular.module("security.retryQueue",[]).factory("securityRetryQueue",["$q","$log",function(a,b){var c=[],d={onItemAddedCallbacks:[],hasMore:function(){return c.length>0},push:function(a){c.push(a),angular.forEach(d.onItemAddedCallbacks,function(c){try{c(a)}catch(d){b.error("securityRetryQueue.push(retryItem): callback threw an error"+d)}})},pushRetryFn:function(b,c){1===arguments.length&&(c=b,b=void 0);var e=a.defer(),f={reason:b,retry:function(){a.when(c()).then(function(a){e.resolve(a)},function(a){e.reject(a)})},cancel:function(){e.reject()}};return d.push(f),e.promise},retryReason:function(){return d.hasMore()&&c[0].reason},cancelAll:function(){for(;d.hasMore();)c.shift().cancel()},retryAll:function(){for(;d.hasMore();)c.shift().retry()}};return d}]),angular.module("security.interceptor",["security.retryQueue"]).factory("securityInterceptor",["$injector","securityRetryQueue",function(a,b){return function(c){return c.then(null,function(d){return 401===d.status&&(c=b.pushRetryFn("unauthorized-server",function(){return a.get("$http")(d.config)})),c})}}]).config(["$httpProvider",function(a){a.responseInterceptors.push("securityInterceptor")}]),angular.module("security.service",["security.retryQueue","security.login","ui.bootstrap.modal","ngCookies"]).factory("security",["$http","$q","$location","securityRetryQueue","$modal","$cookieStore","$cookies",function(a,b,c,d,e,f,g){function h(a){a=a||"/",c.path(a)}function i(){if(k)throw new Error("Trying to open a dialog that is already open!");k=e.open({templateUrl:"views/loginForm.html",controller:"LoginFormController"})}function j(a){k&&k.close(a)}var k=null;d.onItemAddedCallbacks.push(function(){d.hasMore()&&l.showLogin()});var l={getLoginReason:function(){return d.retryReason()},showLogin:function(){i()},login:function(b,c){var d=a.post("api/v1/user/sign_in.json",{user:{email:b,password:c}});return d.then(function(a){return l.currentUser=a.data.user,l.isAuthenticated()&&j(!0),l.isAuthenticated()})},register:function(b,c){var d=a.post("api/v1/user.json",{user:{email:b,password:c}});return d.then(function(a){return console.log(a),l.currentUser=a.data,l.isAuthenticated()&&j(!0),l.isAuthenticated()})},cancelLogin:function(){j(!1),h()},logout:function(b){a.post("users/sign_out").then(function(){l.currentUser=null,h(b)})},requestCurrentUser:function(){return l.isAuthenticated()?b.when(l.currentUser):a.get("/api/v1/current_user").then(function(a){return l.currentUser=a.data.user,l.currentUser})},currentUser:null,isAuthenticated:function(){return!!l.currentUser},currentUserId:function(){return g.current_user_id},isAdmin:function(){return!(!l.currentUser||!l.currentUser.admin)}};return l}]),angular.module("security",["security.service","security.interceptor","security.login","security.authorization"]),angular.module("security",["security.service","security.interceptor","security.login","security.authorization"]),angular.module("services.localizedMessages",[]).factory("localizedMessages",["$interpolate","I18N.MESSAGES",function(a,b){var c=function(a,b){return a||"?"+b+"?"};return{get:function(d,e){var f=b[d];return f?a(f)(e):c(f,d)}}}]),angular.module("security.login.form",["services.localizedMessages","ngCookies"]).controller("LoginFormController",["$scope","security","localizedMessages","$cookieStore",function(a,b,c,d){a.user={},a.authError=null,a.authReason=null,b.getLoginReason()&&(a.authReason=b.isAuthenticated()?c.get("login.reason.notAuthorized"):c.get("login.reason.notAuthenticated")),a.login=function(){a.authError=null,b.login(a.user.email,a.user.password).then(function(b){a.currentUserId=d.current_user_id,b||(a.authError=c.get("login.error.invalidCredentials"))},function(b){a.authError=c.get("login.error.serverError",{exception:b})})},a.register=function(){a.authError=null,b.register(a.user.newEmail,a.user.newPassword).then(function(b){b||(a.authError=c.get("login.error.invalidCredentials"))},function(b){a.authError=c.get("login.error.serverError",{exception:b})})},a.clearForm=function(){a.user={}},a.cancelLogin=function(){b.cancelLogin()}}]),angular.module("security.login.toolbar",[]).directive("loginToolbar",["security",function(a){var b={templateUrl:"views/toolbar.html",restrict:"E",replace:!0,scope:!0,link:function(b){b.isAuthenticated=a.isAuthenticated,b.currentUserId=a.currentUserId,b.login=a.showLogin,b.logout=a.logout,b.$watch(function(){return a.currentUser},function(a){b.currentUser=a})}};return b}]),angular.module("security.login",["security.login.form","security.login.toolbar"]),angular.module("services.i18nNotifications",["services.notifications","services.localizedMessages"]),angular.module("services.i18nNotifications").factory("i18nNotifications",["localizedMessages","notifications",function(a,b){var c=function(b,c,d,e){return angular.extend({message:a.get(b,d),type:c},e)},d={pushSticky:function(a,d,e,f){return b.pushSticky(c(a,d,e,f))},pushForCurrentRoute:function(a,d,e,f){return b.pushForCurrentRoute(c(a,d,e,f))},pushForNextRoute:function(a,d,e,f){return b.pushForNextRoute(c(a,d,e,f))},getCurrent:function(){return b.getCurrent()},remove:function(a){return b.remove(a)}};return d}]),angular.module("services.notifications",[]).factory("notifications",["$rootScope",function(a){var b={STICKY:[],ROUTE_CURRENT:[],ROUTE_NEXT:[]},c={},d=function(a,b){if(!angular.isObject(b))throw new Error("Only object can be added to the notification service");return a.push(b),b};return a.$on("$routeChangeSuccess",function(){b.ROUTE_CURRENT.length=0,b.ROUTE_CURRENT=angular.copy(b.ROUTE_NEXT),b.ROUTE_NEXT.length=0}),c.getCurrent=function(){return[].concat(b.STICKY,b.ROUTE_CURRENT)},c.pushSticky=function(a){return d(b.STICKY,a)},c.pushForCurrentRoute=function(a){return d(b.ROUTE_CURRENT,a)},c.pushForNextRoute=function(a){return d(b.ROUTE_NEXT,a)},c.remove=function(a){angular.forEach(b,function(b){var c=b.indexOf(a);c>-1&&b.splice(c,1)})},c.removeAll=function(){angular.forEach(b,function(a){a.length=0})},c}]),angular.module("services.httpRequestTracker",[]),angular.module("services.httpRequestTracker").factory("httpRequestTracker",["$http",function(a){var b={};return b.hasPendingRequests=function(){return a.pendingRequests.length>0},b}]),angular.module("urbanfunhunterApp").controller("HostManageCtrl",["$scope","host",function(a,b){a.experiences={},a.getExperiencesForHost=function(){b.experiences()}}]),angular.module("urbanfunhunterApp").factory("host",[function(){var a={experiences:function(b){var c=$http({method:"GET",url:"api/v1/host/:id/experiences",params:{id:b}});return c.then(function(b){return a.hostExperiences=b.data,a.hostExperiences})}};return a}]),angular.module("urbanfunhunterApp").controller("MyexperiencesManageCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("urbanfunhunterApp").factory("myexperiences.manage",function(){var a=42;return{someMethod:function(){return a}}}),angular.module("textAngular",[]).directive("compile",["$compile",function(a){return function(b,c,d){b.$watch(function(a){return a.$eval(d.compile)},function(d){c.html(d),a(c.contents())(b)})}}]).directive("textAngular",["$compile","$sce","$window","$timeout",function(a,b,c,d){var e=function(a){return b.trustAsHtml(a)};try{angular.isDefined(angular.module("ngSanitize"))}catch(f){e=function(a){return a}}var g={theme:function(a,b){if(b.disableStyle)return!1;a.theme=b.theme?b.theme:{};var c={resize:"both","overflow-y":"auto","min-height":"300px","text-align":"left",padding:"4px"},d={margin:"0.2em","text-align":"right",overflow:"hidden","border-radius":"3px",display:"inline-block"};a.theme.editor=a.theme.editor?angular.extend(a.theme.editor,c):{background:"#FFFFFF",color:"#5E5E5E",border:"1px solid #C4C4C4",padding:"4px",resize:"both","overflow-y":"auto","min-height":"300px","text-align":"left","border-radius":"3px"},a.theme.toolbar=a.theme.toolbar?angular.extend(a.theme.toolbar,d):{margin:"0.2em","text-align":"right",overflow:"hidden","border-radius":"3px",border:"1px #C4C4C4",display:"inline-block"},a.theme.toolbarItems=a.theme.toolbarItems?a.theme.toolbarItems:{cursor:"pointer",display:"inline-block",padding:"0.2em 0.4em","margin-left":"0em",background:"gray",color:"white","font-size":"14px"},a.theme.insertForm=a.theme.insertForm?a.theme.insertForm:{"text-align":"right",padding:"0.2em"},a.theme.insertFormBtn=a.theme.insertFormBtn?a.theme.insertFormBtn:{"margin-top":"0.2em"}},compileHtml:function(a,b){var c=$("<div>").append(b).html().replace(/(class="(.*?)")|(class='(.*?)')/g,"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/style=("|')(.*?)("|')/g,"");"load"==a.showHtml?(a.textAngularModel.text=e(c),a.textAngularModel.html=e(c.replace(/</g,"&lt;")),a.showHtml=a.showHtmlDefault||!1):a.showHtml?a.textAngularModel.text=e(c):a.textAngularModel.html=e(c.replace(/</g,"&lt;")),a.$parent.textAngularOpts.textAngularEditors[a.name].html=c},wrapSelection:function(a,b){document.execCommand(a,!1,b)},preCompileHtml:function(a,b){if(a.showHtml)var c=$(b).find(".textAngular-html").html();else var c=$(b).find(".textAngular-text").html();g.compileHtml(a,c)},toolbarFn:{html:function(a,b){if(a.showHtml=!a.showHtml,a.showHtml){var c=$(b).find(".textAngular-text").html();d(function(){$(b).find(".textAngular-html").focus()},100)}else{var c=$(b).find(".textAngular-html").html();d(function(){$(b).find(".textAngular-text").focus()},100)}g.compileHtml(a,c)},h1:function(){g.wrapSelection("formatBlock","<H1>")},h2:function(){g.wrapSelection("formatBlock","<H2>")},h3:function(){g.wrapSelection("formatBlock","<H3>")},p:function(){g.wrapSelection("formatBlock","<P>")},pre:function(){g.wrapSelection("formatBlock","<PRE>")},ul:function(){g.wrapSelection("insertUnorderedList",null)},ol:function(){g.wrapSelection("insertOrderedList",null)},quote:function(){g.wrapSelection("formatBlock","<BLOCKQUOTE>")},undo:function(){g.wrapSelection("undo",null)},redo:function(){g.wrapSelection("redo",null)},b:function(){g.wrapSelection("bold",null)},justifyLeft:function(){g.wrapSelection("justifyLeft",null)},justifyRight:function(){g.wrapSelection("justifyRight",null)},justifyCenter:function(){g.wrapSelection("justifyCenter",null)},i:function(){g.wrapSelection("italic",null)},clear:function(){g.wrapSelection("FormatBlock","<div>")},insertImage:function(a){return 1==a.inserting?(a.inserting=!1,!1):(a.insert.model="",a.inserting=!0,a.insert.text="Insert Image",a.currentInsert="insertImage",void 0)},insertHtml:function(a){return 1==a.inserting?(a.inserting=!1,!1):(a.insert.model="",a.inserting=!0,a.insert.text="Insert HTML",a.currentInsert="insertHtml",void 0)},createLink:function(a){return 1==a.inserting?(a.inserting=!1,!1):(a.insert.model="",a.inserting=!0,a.insert.text="Make a Link",a.currentInsert="createLink",void 0)}}};return{template:"<div class='textAngular-root' style='text-align:right;'>    <div class='textAngular-toolbar' ng-style='theme.toolbar'><span ng-repeat='toolbarItem in toolbar' title='{{toolbarItem.title}}' class='textAngular-toolbar-item' ng-style='theme.toolbarItems' ng-mousedown='runToolbar(toolbarItem.name,$event)' unselectable='on' compile='toolbarItem.icon' name='toolbarItem.name'></span></div>    <form class='textAngular-insert' ng-show='inserting' ng-style='theme.insertForm'><input type='text' ng-model='insert.model' required><div class='textAngular-insert-submit'><button ng-style='theme.insertFormBtn' ng-mousedown='finishInsert();'>{{insert.text}}</button></div></form>    <pre contentEditable='true' ng-show='showHtml' class='textAngular-html' ng-style='theme.editor' ng-bind-html='textAngularModel.html' ></pre>    <div contentEditable='true' ng-hide='showHtml' class='textAngular-text' ng-style='theme.editor' ng-bind-html='textAngularModel.text' ></div>    </div>",replace:!0,scope:{},restrict:"A",controller:["$scope","$element","$attrs",function(a,b){console.log("Thank you for using textAngular! http://www.textangular.com"),a.insert={},a.finishInsert=function(){g.wrapSelection(a.currentInsert,a.insert.model),g.preCompileHtml(a,b),a.inserting=!1},a.runToolbar=function(c,d){d.preventDefault();g.toolbarFn[c](a,b);"html"!=c&&g.preCompileHtml(a,b)}}],link:function(a,b,c){a.$parent.$watch("textAngularOpts",function(){if(a.$parent.textAngularOpts||console.log("No textAngularOpts config object found in scope! Please create one!"),a.showHtml="load",!c.textAngularName)return console.log("No 'text-angular-name' directive found on directve root element. Please add one! "),!1;var d=c.textAngularName;if(a.name=d,a.$parent.textAngularOpts.textAngularEditors||(a.$parent.textAngularOpts.textAngularEditors={}),a.$parent.textAngularOpts.textAngularEditors[d]){var f=a.$parent.textAngularOpts.textAngularEditors[d];a.toolbar=a.$parent.textAngularOpts.textAngularEditors[d].toolbar}else{a.$parent.textAngularOpts.textAngularEditors[d]={};var f=a.$parent.textAngularOpts;a.toolbar=a.$parent.textAngularOpts.toolbar}a.$parent.$watch('textAngularOpts.textAngularEditors["'+d+'"].html',function(b,c){$(":focus").parents(".textAngular-root")[0]||(a.textAngularModel.text=e(c),a.textAngularModel.html=e(c.replace(/</g,"&lt;")))},!0),g.theme(a,f),a.textAngularModel={},g.compileHtml(a,f.html),$(b).find(".textAngular-text,.textAngular-html").on("keyup",function(){if(a.showHtml){$(this.parentNode).find(".textAngular-html").html()}else{$(this.parentNode).find(".textAngular-text").html()}a.$apply(g.preCompileHtml(a,this.parentNode))})})}}}]),angular.module("urbanfunhunterApp").controller("ExperiencesNewCtrl",["$scope","newExperienceFactory",function(a,b){a.textAngularOpts={textAngularEditors:{eventdescriptionTextArea:{toolbar:[{icon:"<i class='icon-code'></i>",name:"html",title:"Toggle Html"},{icon:"h1",name:"h1",title:"H1"},{icon:"h2",name:"h2",title:"H2"},{icon:"pre",name:"pre",title:"Pre"},{icon:"<i class='icon-bold'></i>",name:"b",title:"Bold"},{icon:"<i class='icon-italic'></i>",name:"i",title:"Italics"},{icon:"p",name:"p",title:"Paragraph"},{icon:"<i class='icon-list-ul'></i>",name:"ul",title:"Unordered List"},{icon:"<i class='icon-list-ol'></i>",name:"ol",title:"Ordered List"},{icon:"<i class='icon-rotate-right'></i>",name:"redo",title:"Redo"},{icon:"<i class='icon-undo'></i>",name:"undo",title:"Undo"},{icon:"<i class='icon-ban-circle'></i>",name:"clear",title:"Clear"},{icon:"<i class='icon-file'></i>",name:"insertImage",title:"Insert Image"},{icon:"<i class='icon-html5'></i>",name:"insertHtml",title:"Insert Html"},{icon:"<i class='icon-link'></i>",name:"createLink",title:"Create Link"}],html:"<p>Enter the description of the event</p>",disableStyle:!1,theme:{editor:{"font-size":"1em","border-radius":"4px",padding:"11px",background:"white",border:"1px solid rgba(2,2,2,0.1)"},insertFormBtn:{background:"red",color:"white",padding:"2px 3px","font-size":"15px","margin-top":"4px","border-radius":"4px","font-family":"Roboto",border:"2px solid red"}}}}},a.uploadFiles=function(){filepicker.pickAndStore({mimetype:"image/*",multiple:!0},{},function(b){console.log(b),a.event_images=b,console.log(a.event_images)},function(a){console.log(a)})},a.newEvent=function(c){var c={experience:{name:a.eventName,description:a.textAngularOpts.textAngularEditors.eventdescriptionTextArea.html,price:a.eventPrice,experience_date:a.eventDate,experience_time:a.eventTime,venue:a.eventVenue,images:a.event_images}};console.log(c);b.save(c,function(a){console.log("Woohoo! It is getting to the callbackl"),console.log("The callback is"+a),console.log("The callback event is"+a.event)})}}]),angular.module("urbanfunhunterApp").factory("newExperienceFactory",["$http","$location",function(a,b){var c={};return c={save:function(d){var e=a.post("/api/v1/experiences.json",d);return e.then(function(a){c.newExperience=a.data;var d="/experiences/"+a.data.id;return b.path(d),c.newExperience})}}}]),angular.module("urbanfunhunterApp").controller("ExperiencesShowCtrl",["$scope","Experience","$routeParams",function(a,b,c){console.log("Tjhe route params for experienceId is:"+c.experienceId),b.getEvent(c.experienceId).then(function(b){a.experience=b,console.log("The experience desc is:"+a.experience.description)}),b.getExperienceImages(c.experienceId).then(function(b){a.slides=b,console.log("The experience desc is:"+a.experience.description)}),a.myInterval=5e3,angular.extend(a,{position:{coords:{latitude:45,longitude:-73}},centerProperty:{latitude:45,longitude:-73},zoomProperty:4,markersProperty:[{latitude:45,longitude:-74}],clickedLatitudeProperty:null,clickedLongitudeProperty:null,eventsProperty:{click:function(a,b,c){$log.log("user defined event on map directive with scope",this),$log.log("user defined event: "+b,a,c)}}})}]),angular.module("urbanfunhunterApp").factory("Experience",["$http",function(a){var b={experiences:function(){var b="/api/v1/experiences/",c=a.get(b).then(function(a){return console.log(a),a.data});return c},getEvent:function(b){var c="/api/v1/experiences/"+b,d=a.get(c).then(function(a){return console.log(a),a.data});return d},getExperienceImages:function(b){var c="/api/v1/experiences/"+b+"/images",d=a.get(c).then(function(a){return a.data});return d}};return b}]),angular.module("urbanfunhunterApp").filter("renderhtml",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),angular.module("Directive.AddThis",[]).directive("addthisToolbox",function(){return{restrict:"A",transclude:!0,replace:!0,template:"<div ng-transclude></div>",link:function(a,b){addthis.init(),addthis.toolbox($(b).get())}}}),function(){function a(a,b){return Math.abs(a-b)<1e-6}var b=function(){function b(b){var d=null,e=[],f=[],g=[],h=angular.extend({},c,b),i=this,j=null;this.center=b.center,this.zoom=h.zoom,this.draggable=h.draggable,this.dragging=!1,this.selector=h.container,this.markers=[],this.options=h.options,this.draw=function(){if(null!=i.center)if(null==d)d=new google.maps.Map(i.selector,angular.extend(i.options,{center:i.center,zoom:i.zoom,draggable:i.draggable,mapTypeId:google.maps.MapTypeId.ROADMAP})),google.maps.event.addListener(d,"dragstart",function(){i.dragging=!0}),google.maps.event.addListener(d,"idle",function(){i.dragging=!1}),google.maps.event.addListener(d,"drag",function(){i.dragging=!0}),google.maps.event.addListener(d,"zoom_changed",function(){i.zoom=d.getZoom(),i.center=d.getCenter()}),google.maps.event.addListener(d,"center_changed",function(){i.center=d.getCenter()}),f.length&&angular.forEach(f,function(a){google.maps.event.addListener(d,a.on,a.handler)});else{google.maps.event.trigger(d,"resize");var b=d.getCenter();a(b.lat(),i.center.lat())&&a(b.lng(),i.center.lng())||d.setCenter(i.center),d.getZoom()!=i.zoom&&d.setZoom(i.zoom)}},this.fit=function(){if(d&&e.length){var a=new google.maps.LatLngBounds;angular.forEach(e,function(b){a.extend(b.getPosition())}),d.fitBounds(a)}},this.on=function(a,b){f.push({on:a,handler:b})},this.addMarker=function(a,b,c,f,g,h,k){if(null==i.findMarker(a,b)){var l=new google.maps.Marker({position:new google.maps.LatLng(a,b),map:d,icon:c});if(null!=f){var m=new google.maps.InfoWindow({content:f});google.maps.event.addListener(l,"click",function(){null!=j&&j.close(),m.open(d,l),j=m})}return e.unshift(l),i.markers.unshift({lat:a,lng:b,draggable:!1,icon:c,infoWindowContent:f,label:g,url:h,thumbnail:k}),l}},this.findMarker=function(b,c){for(var d=0;d<e.length;d++){var f=e[d].getPosition();if(a(f.lat(),b)&&a(f.lng(),c))return e[d]}return null},this.findMarkerIndex=function(b,c){for(var d=0;d<e.length;d++){var f=e[d].getPosition();if(a(f.lat(),b)&&a(f.lng(),c))return d}return-1},this.addInfoWindow=function(a,b,c){var d=new google.maps.InfoWindow({content:c,position:new google.maps.LatLng(a,b)});return g.push(d),d},this.hasMarker=function(a,b){return null!==i.findMarker(a,b)},this.getMarkerInstances=function(){return e},this.removeMarkers=function(a){var b=this;angular.forEach(a,function(a){var c=a.getPosition(),d=c.lat(),f=c.lng(),g=b.findMarkerIndex(d,f);e.splice(g,1),b.markers.splice(g,1),a.setMap(null)})}}var c={zoom:8,draggable:!1,container:null};return b}(),c=angular.module("google-maps",[]);c.directive("googleMap",["$log","$timeout","$filter",function(c,d){var e=function(a){var b=a.map;self.addInfoWindow=function(a,c,d){b.addInfoWindow(a,c,d)}};return e.$inject=["$scope","$element"],{restrict:"ECA",priority:100,transclude:!0,template:"<div class='angular-google-map' ng-transclude></div>",replace:!1,scope:{center:"=center",markers:"=markers",latitude:"=latitude",longitude:"=longitude",zoom:"=zoom",refresh:"&refresh",windows:"=windows",events:"=events"},controller:e,link:function(e,f,g){if(!angular.isDefined(e.center)||!angular.isDefined(e.center.latitude)||!angular.isDefined(e.center.longitude))return c.error("angular-google-maps: could not find a valid center property"),void 0;if(!angular.isDefined(e.zoom))return c.error("angular-google-maps: map zoom property not set"),void 0;angular.element(f).addClass("angular-google-map");var h={options:{}};g.options&&(h.options=angular.fromJson(g.options));var i=new b(angular.extend(h,{container:f[0],center:new google.maps.LatLng(e.center.latitude,e.center.longitude),draggable:"true"==g.draggable,zoom:e.zoom}));if(i.on("drag",function(){var a=i.center;d(function(){e.$apply(function(){e.center.latitude=a.lat(),e.center.longitude=a.lng()})})}),i.on("zoom_changed",function(){e.zoom!=i.zoom&&d(function(){e.$apply(function(){e.zoom=i.zoom})})}),i.on("center_changed",function(){var a=i.center;d(function(){e.$apply(function(){i.dragging||(e.center.latitude=a.lat(),e.center.longitude=a.lng())})})}),angular.isDefined(e.events))for(var j in e.events)e.events.hasOwnProperty(j)&&angular.isFunction(e.events[j])&&i.on(j,function(){e.events[j].apply(e,[i,j,arguments])});"true"==g.markClick&&!function(){var a=null;i.on("click",function(b){null==a?(a={latitude:b.latLng.lat(),longitude:b.latLng.lng()},e.markers.push(a)):(a.latitude=b.latLng.lat(),a.longitude=b.latLng.lng()),d(function(){e.latitude=a.latitude,e.longitude=a.longitude,e.$apply()})})}(),e.map=i,angular.isUndefined(e.refresh())?i.draw():e.$watch("refresh()",function(a,b){a&&!b&&i.draw()}),e.$watch("markers",function(b){d(function(){angular.forEach(b,function(a){i.hasMarker(a.latitude,a.longitude)||i.addMarker(a.latitude,a.longitude,a.icon,a.infoWindow)});var c=[];angular.forEach(i.getMarkerInstances(),function(b){for(var d=b.getPosition(),f=d.lat(),g=d.lng(),h=!1,i=0;i<e.markers.length;i++){var j=e.markers[i];a(j.latitude,f)&&a(j.longitude,g)&&(h=!0)}h||c.push(b)}),c.length&&i.removeMarkers(c),"true"==g.fit&&b&&b.length>1&&i.fit()})},!0),e.$watch("center",function(a,b){a!==b&&(i.dragging||(i.center=new google.maps.LatLng(a.latitude,a.longitude),i.draw()))},!0),e.$watch("zoom",function(a,b){a!==b&&(i.zoom=a,i.draw())})}}}])}(),angular.module("urbanfunhunterApp").filter("group",function(){return function(a,b){return _.groupBy(a,function(a,c){return Math.floor(c/b)})}});